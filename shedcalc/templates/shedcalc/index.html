{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'shedcalc/style.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'shedcalc/normalize.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'shedcalc/skeleton.css' %}" />

<a href="https://github.com/jonnyhuck/shed-earth" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

<script>
	/**
	 * Write a reference for today's date into the ref div
	 */
	function populateReference(){
		//populate the suggested reference for today
		var d = new Date(); 
		document.getElementById('ref').innerHTML = ["<p>Tomkins, M., Huck, J., Dortch, J., Hughes P. D., Kirkbride, M. & Barr, I. (", d.getFullYear(),"). SHED Earth. <a href=\"http://www.shed.earth/shedcalc\">http://shed.earth</a>. <em>Accessed ", d.getDate(), "/", d.getMonth()+1, "/", d.getFullYear(), ".</em></p>"].join('');
	}

	/**
	 * Populate the form with a sample dataset
	 */
	function loadDemoValues(){
		document.getElementById('tabdata').value = ["Sample#1	56.635	-4.778	52	47	45	46	44	52	46	45	45	50	46	48	43	43	44	43	52	50	48	46	46	45	43	48	47	50	50	50	50	44","Sample#2	56.635	-4.781	32	27	25	26	24	32	26	25	25	30	26	28	23	23	24	23	32	30	28	26	26	25	23	28	27	30	30	30	30	24","Sample#3	56.634	-4.781	40	50	49	46	50	44	43	43	46	50	44	40	45	48	43	46	43	52	45	40	44	48	52	42	50	45	50	40	48	47","Sample#4	56.634	-4.779	44	48	42	47	42	40	40	50	46	46	50	47	50	43	44	45	44	50	44	48	42	50	46	42	42	48	43	46	52	48","Sample#5	56.634	-4.777	54	58	52	57	52	50	50	60	56	56	60	57	60	53	54	55	54	60	54	58	52	60	56	52	52	58	53	56	62	58","Sample#6	56.634	-4.775	34	38	32	37	32	30	30	40	36	36	40	37	40	33	34	35	34	40	34	38	32	40	36	32	32	38	33	36	42	38",].join("\n");
		document.getElementById('before').value = "45";
		document.getElementById('after').value = "44";
		document.getElementById('boulder').value = "48.08";
	}
	
	/**
	 * Verify form values before submitting for calculation
	 */
	function validateForm(){	
		
		//verify that there is some data
		if (document.getElementById('tabdata').value == "") { 
			alert("Please paste some data into the R Values box");
			return false; 
		}
		
		//get the number of columns and rows in the R-values data
		var cols = document.getElementById('tabdata').value.split(/\r?\n/)[0].split('\t').length
		var rows = document.getElementById('tabdata').value.split(/\r?\n/).length
		
		//verify that there are at least 4 columns
		if(cols < 5) {
			alert(["You need at least 4 tab-separated columns in the R Values box\nAt the moment I can see",rows.toString(),"rows and",cols.toString(),"columns"].join(' '));
			return false; 
		}
		
		//verify that it all columns but the first are numeric
		for(var i = 0; i < rows; i++){
			
			//extract the rows
			rowData = document.getElementById('tabdata').value.split(/\r?\n/);
			
			//loop through columns: skip the first row as this CAN be a string
			for(var j = 1; j < cols; j++){	
		
				// extract the columns from the current row
				colData = rowData[i].split('\t');
				
				if(colData.length == cols){
			
					//verify numeric
					if(isNaN(colData[j])){
						alert(["R-values need to be numeric\nNon-numeric value found at row", i+1, "column", j+1].join(' '));
						return false; 
					}
				} else {
					alert(["Warning: row", i, "has", colData.length, "columns, expected", cols].join(" "));
					return false;
				}
			}
		}
		
		//verify that there is some data
		if (document.getElementById('before').value == "") { 
			alert("Please enter some data into the Pre-Calibration Value box");
			return false; 
		}
		//verify that it is numeric
		if (isNaN(document.getElementById('before').value)) { 
			alert("The Pre-Calibration Value must be numeric");
			return false; 
		}
		//verify that there is some data
		if (document.getElementById('after').value == "") { 
			alert("Please enter some data into the Post-Calibration Value box");
			return false; 
		}
		//verify that it is numeric
		if (isNaN(document.getElementById('after').value)) { 
			alert("The Post-Calibration Value must be numeric");
			return false; 
		}
		//verify that there is some data
		if (document.getElementById('boulder').value == "") { 
			alert("please enter some data into the Mean R Value (Boulder) box");
			return false; 
		}
		//verify that it is numeric
		if (isNaN(document.getElementById('boulder').value)) { 
			alert("The Mean R Value (Boulder) must be numeric");
			return false; 
		};
	
		return true;
	}
	
	
	/**
	 * Event handler for when the production rate select tool is changed
	 */
	function prodrate_select(selectedIndex){
		// TODO: update chart
	}
	
	
	/**
	 * Event handler for when the production rate select tool is changed
	 */
	function region_select(selectedIndex){
	
		// set to default production rate
		if (selectedIndex == 0) {			// GB = Lock Lomond
			document.getElementById('prodrate').value = 0;
		} else if (selectedIndex == 1){		// PY = CRONUS
			document.getElementById('prodrate').value = 2;
		}
		
		//TODO: update chart
	}
	
</script>

<div class='container'>
	<h1>SHED Earth</h1>
	<div class='underline'>	
		<p>Welcome to SHED Earth. SHED refers to Schmidt Hammer Exposure Dating: a technique 
		that provides a cost-effective solution for dating the exposure of granite surfaces. 
		This can be used to constrain the timing of past events, which permits a better 
		understanding of the links between climate and landscape evolution.</p>
		 
		<p>The approach is based upon a study by Tomkins et al. (2016)<sup><a href="#References">1</a></sup>, 
		in which a statistically significant relationship was observed between the exposure ages 
		<em>(derived from terrestrial cosmogenic nuclide dating)</em>, and Schmidt Hammer rebound 
		values (R-values) of 25 granitic surfaces from NW England and Scotland. These data indicate 
		that granite can weather linearly over significant spatial scales for regions of similar 
		climate and permits the estimation of exposure ages based upon the R-value recorded on 
		the rock. The technique has been demonstrated to be of comparable accuracy and precision 
		to ages derived from terrestrial cosmogenic nuclide dating, but without the significant 
		expense that goes along with the use of such techniques, making it useful for researchers 
		and students alike. This dataset has recently been updated with 29 additional exposure ages from 
		across Scotland and Ireland<sup><a href="#References">2</a></sup> and is now applicable over 
		the timescale 0.8 - 23.8 thousand years ago, almost the entirety of British-Irish Ice Sheet 
		retreat from its maximum extent.</p>
		
		<form action="{% url 'shedcalc:results' %}" method="post" onsubmit="return validateForm()">
		
			<h3>Calibration Curve</h3>
			<label for='region'>Select Region:</label>
			<select id='region' name='region' onchange="region_select(this.selectedIndex);">
				<!-- NB: These values need to be reflected in views.py -->
				<option value='0' default>British Isles</option>
				<option value='1'>Pyrenees</option>
			</select>
			<!-- TODO: UPDATE CURVE ON CHANGE-->
			<img src="./chartpy.png" alt="regression chart" />
		
			<small><p>This is the latest calibration curve for the British Isles and is based on 52 
			TCN dated surfaces from Scotland, NW England and Ireland.  These exposure ages are calculated using the time-dependent 
			Lm scaling scheme<sup><a href="#References">3,4</a></sup>, the Loch Lomond production rate
			<sup><a href="#References">5</a></sup> and assuming 0 mm ka<sup>-1</sup> erosion. For full 
			details, see Tomkins et al. (2017)<sup><a href="#References">2</a></sup>. It is anticipated that as 
			new calibration curves are constructed in similar well-dated regions, they will be made 
			available for use on this site.</p></small>
		
			<h3>Production Rate</h3>
			<small><p>Blah blah blah...</p></small>
			<label for='prodrate'>Select Production Rate:</label>
			<!-- TODO: UPDATE CURVE ON CHANGE-->
			<select id='prodrate' name='prodrate' onchange="prodrate_select(this.selectedIndex);">
				<!-- NB: These values need to be reflected in views.py -->
				<option value='0' default>Loch Lomond</option>
				<option value='1'>Glen Roy</option>
				<option value='2'>CRONUS-calc default</option>
			</select>
		
			<h3>Data Input</h3>

			{% csrf_token %}
					
			<h5>R Values</h5>
			<small><p>Users should input raw R-value data in the format displayed below. 
			Inputs include samples IDs and locations (latitude/longitude) which are stored 
			in database for monitoring of site usage. User data (R-values and Schmidt Hammer 
			exposure ages) are not recorded. While we encourage users to record 30 R-values 
			per surface to ensure statistically significant results, the tool will also 
			operate on smaller sample sizes. This tool performs instrument and age calibration 
			(see below) and returns calibrated R-values and Schmidt Hammer exposure ages with 
			1σ uncertainties for each sampled surface. Data should be pasted into the 
			box below in tab-delimited format, which is most easily achieved by copying it 
			directly out of a spreadsheet (<a href="http://huckg.is/shed-earth/shed-earth-sample-format.xlsx">download example here</a>). 
			The column order should be <strong>name latitude 
			longitude</strong> followed by the R-values (recommended 30) for that surface 
			<em>(click the <strong>Load Demo Values</strong> button at the bottom of this 
			form for an example)</em>.</p></small>
			
			<label for='tabdata'>R Values:</label>
			<textarea id='tabdata' name='tabdata' class='u-full-width' ></textarea><br/>
			
			
			
			<h5>Instrument Calibration Values</h5>
			<small><p>In order to ensure that the Schmidt Hammer is functioning correctly and 
			yielding the same R-value on an identical rock surface, even after hundreds or 
			thousands of impacts<sup><a href="#References">6</a></sup>, users should test their Schmidt Hammer using a suitable 
			surface before and after sampling. Previous studies have advocated the use of the Proceq 
			test anvil<sup><a href="#References">6,7</a></sup>. An implicit assumption in the test anvil calibration procedure is 
			that the difference (%) between the specified anvil standard and the recorded average 
			is consistent throughout the operational range of the Schmidt Hammer i.e. a 20% R-value 
			difference between two Schmidt Hammers as recorded using the test anvil should also be 
			replicated on a range of natural rock surfaces. However, this is not supported by evidence<sup><a href="#References">2</a></sup> 
			as the difference between Schmidt Hammers as recorded using the test anvil is not maintained 
			throughout the tools’ operational range but decreases significantly as the surface 
			R-value decreases. As a result, this method over-estimates R-values for surfaces typically 
			tested by Quaternary researchers<sup><a href="#References">2</a></sup>.</p> 
			
			<p>For very hard rock surfaces (R-values: ≥ 70), the test 
			anvil method may be more effective, as variation between Schmidt Hammers as recorded on 
			the anvil is probably representative of variability on sampled rock surfaces. However, 
			for the vast majority of rock surfaces tested by Quaternary researchers (R-values: ≤ 60), 
			the anvil method will significantly overestimate R-values<sup><a href="#References">2</a></sup>. Thus, users should perform 
			instrument calibration using a calibration surface which is within the range of their 
			sample data and that is of sufficient size<sup><a href="#References">8</a></sup>, 
			that is free of surface discontinuities<sup><a href="#References">9</a></sup> 
			and lichen<sup><a href="#References">10</a></sup> and that is easily accessible. Users should input pre- and post-calibration 
			values for their chosen surface and input their raw R-value data in chronological order 
			(related to the time of sampling). R-values will be corrected assuming linear R-value 
			drift<sup><a href="#References">1</a></sup> based on the variance between pre- and post-calibration values and the number 
			of individual R-values. This procedure is most effective when periods between calibration tests are short<sup><a href="#References">11</a></sup>.
			</p></small>
			
			<label for='before'>Pre-Calibration Value:</label>
			<input type="text"  id='before' name='before'></input><br/>
	
			<label for='after'>Post-Calibration Value:</label>
			<input type="text"  id='after' name='after'></input><br/>
	
			<h5>Age Calibration Value</h5>
			<small><p>The goal of SHED-Earth is to encourage researchers and students to test 
			and use our calibration curve on undated landforms and compare results with independent 
			dating methods (TCN, <sup>14</sup>C, OSL), in order to evaluate its effectiveness. As such, the standardisation 
			of different Schmidt Hammers<sup><a href="#References">11</a></sup> and different user strategies
			<sup><a href="#References">12</a></sup> to a verifiable standard (e.g. University of Manchester calibration boulder) 
			is necessary to minimise potential errors in SHED age estimates.</p>
			
			<p>Users who have tested their Schmidt Hammer using the University of Manchester 
			calibration boulder<sup><a href="#References">13</a></sup> should input their mean R-Value here. A correction factor (%) 
			is applied to all user R-values.</p>
			
			<p>Users who have not completed age calibration using the University of Manchester 
			calibration boulder should use the default value (R-value: 48.08 ± 0.82). This is the 
			mean R-value generated by the Proceq N-type Schmidt Hammer used to generate the original 
			calibration curve<sup><a href="#References">1</a></sup>. As such, no correction for variance between different Schmidt 
			Hammers or between users will be made. This may be appropriate if users have calibrated 
			their Schmidt Hammer using one of the 125 boulder or bedrock surfaces reported in 
			previous publications<sup><a href="#References">1,2</a></sup> although we advocate 
			caution with this approach<sup><a href="#References">13</a></sup>. Although 
			variance between Schmidt Hammers is usually small for surfaces with R-values of ≤ 60, 
			variance can exceed ~10% for older Schmidt Hammers and should be accounted for
			<sup><a href="#References">2</a></sup>. Users can contact 
			<script type="text/javascript" language="javascript">
				<!--
				// Email obfuscator script 2.1 by Tim Williams, University of Arizona
				// Random encryption key feature coded by Andrew Moulden
				// This code is freeware provided these four comment lines remain intact
				// A wizard to generate this code is at http://www.jottings.com/obfuscator/
				{ coded = "HW77GNS.7wHXPFr@Cwr7DzWi.HWFdGNr7Nz.Wd.2X"
				  key = "p0hSYtW26OkiZDFNr3HyUf84wbBauExRdTgnesAmVCKGIo7jMl1XPc5qvz9JLQ"
				  shift=coded.length
				  link=""
				  for (i=0; i<coded.length; i++) {
					if (key.indexOf(coded.charAt(i))==-1) {
					  ltr = coded.charAt(i)
					  link += (ltr)
					}
					else {     
					  ltr = (key.indexOf(coded.charAt(i))-shift+key.length) % key.length
					  link += (key.charAt(ltr))
					}
				  }
				document.write("<a href='mailto:"+link+"'>Matt Tomkins</a>")
				}
				//-->
			</script><noscript>Matt Tomkins</noscript> or 
			<script type="text/javascript" language="javascript">
				<!--
				// Email obfuscator script 2.1 by Tim Williams, University of Arizona
				// Random encryption key feature coded by Andrew Moulden
				// This code is freeware provided these four comment lines remain intact
				// A wizard to generate this code is at http://www.jottings.com/obfuscator/
				{ coded = "tVheD.4ezlLq@OVDLqKhlKz.VL.ks"
				  key = "h5xWkBY4ACRMmI8nzvb1FglLTejJ6qaUysHfQuNpdOG9DPiEXrw0ZSKtc2oV73"
				  shift=coded.length
				  link=""
				  for (i=0; i<coded.length; i++) {
					if (key.indexOf(coded.charAt(i))==-1) {
					  ltr = coded.charAt(i)
					  link += (ltr)
					}
					else {     
					  ltr = (key.indexOf(coded.charAt(i))-shift+key.length) % key.length
					  link += (key.charAt(ltr))
					}
				  }
				document.write("<a href='mailto:"+link+"'>Dr Jason Dortch</a>")
				}
				//-->
			</script><noscript>Dr Jason Dortch.</noscript> at the University of Manchester 
			for advice on age calibration.</p></small>
			
			<label for='boulder'>Mean R Value (Boulder):</label>
			<input type="text"  id='boulder' name='boulder' value="48.08" ></input><br/>
	
			<input id="calculate" class="button-primary" type="submit" value="Calculate" ></input>
			
			<h5>Demo Data</h5>
			<small><p>If you would like to have a go with the website but do not have data 
			to hand, simply click here for to load some demo data into the above form:</p></small>
			<input class="button" type="button" value="Load Demo Values" onclick="loadDemoValues()"></input>
		</form>
	</div>
	<div class='underline'>
		<h3>Information</h3>
		<h5>Referencing this site</h5>
		<p>If you use this site in academic works, please reference it accordingly:</p>
		<div id='ref'></div><script>populateReference();</script>
		<h5>Source Code</h5>
		<p>The source code for this website is available on <a href="https://github.com/jonnyhuck/shed-earth">GitHub</a>.</p>
		
		<h5 id="References">References</h5>
		<ol>
			<li><a href="https://doi.org/10.1016/j.quageo.2016.02.002">Tomkins, M. D., Dortch, J. M., & Hughes, P. D. (2016). Schmidt Hammer exposure dating (SHED): Establishment and implications for the retreat of the last British Ice Sheet. Quaternary Geochronology, 33, 46–60.</a></li>
			<li>Tomkins, M. D., Huck, J. J., Dortch, J. M., Hughes P. D., Kirkbride, M. & Barr, I. (2017) Schmidt Hammer exposure dating (SHED): Calibration procedures, new exposure age data and an online calculator, in. prep.</li>
			<li><a href="https://doi.org/10.1016/0012-821X(91)90220-C">Lal, D. (1991). Cosmic ray labeling of erosion surfaces: in situ nuclide production rates and erosion models. Earth and Planetary Science Letters, 104(2-4), 424-439.</a></li>
			<li><a href="http://dx.doi.org/10.1029/2000JB900181">Stone, J. O. (2000). Air pressure and cosmogenic isotope production. Journal of Geophysical Research: Solid Earth, 105(B10), 23753-23759.</a></li>
			<li><a href="https://doi.org/10.1016/j.quascirev.2012.09.002">Fabel, D., Ballantyne, C. K., & Xu, S. (2012). Trimlines, blockfields, mountain-top erratics and the vertical dimensions of the last British–Irish Ice Sheet in NW Scotland. Quaternary Science Reviews, 55, 91-102.</a></li>
			<li><a href="https://doi.org/10.1016/j.quageo.2016.08.009">Winkler, S., & Matthews, J. A. (2016). Inappropriate instrument calibration for Schmidt-hammer exposure-age dating (SHD) – A comment on Dortch et al., Quaternary Geochronology 35 (2016), 67–68. Quaternary Geochronology, 36, 102–103.</a></li>
			<li><a href="https://www.proceq.com/compare/schmidt-rebound-hammers">Testing anvil Euro "N/NR/ND/L/LR/LD" (310 09 040).</a></li>
			<li><a href="https://doi.org/10.1002/esp.402">Sumner, P., & Nel, W. (2002). The effect of rock moisture on Schmidt hammer rebound: Tests on rock samples from Marion Island and South Africa. Earth Surface Processes and Landforms, 27(10), 1137–1142.</a></li>
			<li><a href="https://doi.org/10.1002/esp.3290080311">Williams, R. B. G., & Robinson, D. A. (1983). The effect of surface texture on the determination of the surface hardness of rock using the schmidt hammer. Earth Surface Processes and Landforms, 8(3), 289–292.</a></li>
			<li><a href="https://doi.org/10.1111/j.1468-0459.2008.00346.x">Matthews, J. A., & Owen, G. (2008). Endolithic lichens, rapid biological weathering and schmidt hammer r-values on recently exposed rock surfaces: Storbreen glacier foreland, jotunheimen, Norway. Geografiska Annaler, Series A: Physical Geography, 90(4), 287–297.</a></li>
			<li>McCarroll, D. (1987). The Schmidt hammer in geomorphology: five sources of instrument error. Br. Geomorphol. Res. Group Tech. Bull., 36, 16–27.</li>
			<li><a href="https://doi.org/10.1002/esp.2040">Viles, H., Goudie, A., Grab, S., & Lalley, J. (2011). The use of the Schmidt Hammer and Equotip for rock hardness assessment in geomorphology and heritage science: A comparative analysis. Earth Surface Processes and Landforms, 36(3), 320–333.</a></li>
			<li><a href="https://doi.org/10.1016/j.quageo.2016.06.001">Dortch, J. M., Hughes, P. D., & Tomkins, M. D. (2016). Schmidt hammer exposure dating (SHED): Calibration boulder of Tomkins et al. (2016). Quaternary Geochronology, 35, 67–68.</a></li>			
		</ol>
	</div>
</div>